name: Reject Change Workflow
type: Conversation/Sequential Workflow Operation
description: Discards a previously proposed change by removing its proposal state.
postfix:
  type: Text
  description: Optional postfix used while building proposed change state key.
steps:
  - name: Prepare
    type: Conversation/JavaScript Code
    code: |
      const invalid = (reason) => ({
        changeset: [],
        events: [{ type: 'Conversation/Proposed Change Invalid', reason }]
      });

      const postfixValue = currentContract?.postfix || '';
      const path = '/proposedChange' + postfixValue;

      if (!document(path)) {
        return invalid('no proposed change at ' + path);
      }

      return {
        changeset: [{ op: 'remove', path }]
      };

  - name: Apply
    type: Conversation/Update Document
    changeset: ${steps.Prepare.changeset}
